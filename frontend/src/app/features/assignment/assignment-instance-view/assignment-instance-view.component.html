<p-confirmDialog/>

<h3 class="mb-3">{{ assignment.name }}</h3>

<p-accordion [multiple]="true" [activeIndex]="assignment.targetGroups">
  @for (group of groups; track group) {
    <p-accordionTab>
      <ng-template pTemplate="header">
        <span class="font-bold white-space-nowrap">{{ 'course.assignmentView.group' | translate }} {{ group }}</span>
      </ng-template>

      <p-table [rowHover]="true" [columns]="cols" [value]="assignment.groupedStudents[group]"
               [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header" let-columns>
          <tr>
            @for (column of columns; track column.header) {
              <th [style.width]="column.width + '%'">{{ column.header }}</th>
            }
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr>
            @for (column of columns; track column) {
              <td>
                @if (column.field === 'status') {
                  <p-tag [severity]="getSeverity(rowData[column.field])">{{ rowData[column.field] }}</p-tag>
                } @else if (column.field === 'action') {
                  @if (rowData['status'] === CorrectionStatus.UNDEFINED || rowData['status'] === CorrectionStatus.IN_PROGRESS) {
                    <p-button icon="pi pi-caret-right"
                              [rounded]="true"
                              [text]="true"
                              severity="success"
                              pTooltip="{{ 'course.assignmentView.tt-start' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (click)="onStartOrResumeAction(rowData['id'], rowData['status'], rowData['correctionId'])"/>
                  }

                  @if (rowData['status'] === CorrectionStatus.UNDEFINED) {
                    <p-button icon="pi pi-file-excel"
                              [rounded]="true"
                              [text]="true"
                              severity="secondary"
                              pTooltip="{{ 'course.assignmentView.tt-not-submitted' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (click)="notSubmittedAction(rowData['id'], group)"/>
                  }

                  @if (rowData['status'] === CorrectionStatus.CORRECTED) {
                    <p-button icon="pi pi-pencil"
                              [rounded]="true"
                              [text]="true"
                              severity="secondary"
                              pTooltip="{{ 'course.assignmentView.tt-edit' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (onClick)="editAction(rowData['correctionId'])"/>
                    <p-button icon="pi pi-download"
                              [rounded]="true"
                              [text]="true"
                              severity="secondary"
                              pTooltip="{{ 'course.assignmentView.tt-download' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (onClick)="downloadAction(rowData['correctionId'])"/>
                    <p-button icon="pi pi-eye"
                              [rounded]="true"
                              [text]="true"
                              severity="secondary"
                              pTooltip="{{ 'course.assignmentView.tt-view' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (onClick)="viewOnlyAction(rowData['correctionId'])"/>
                  }

                  @if (rowData['status'] !== CorrectionStatus.UNDEFINED) {
                    <p-button icon="pi pi-trash"
                              [rounded]="true"
                              [text]="true"
                              severity="danger"
                              pTooltip="{{ 'course.assignmentView.tt-delete' | translate }}"
                              tooltipPosition="top"
                              showDelay="500"
                              (click)="deleteAction(rowData['correctionId'], group)"/>
                  }
                } @else if (column.field === 'lateSubmission') {
                  @if (rowData['lateSubmission']) {
                    <p-button icon="pi pi-flag-fill"
                              pTooltip="{{ 'course.assignmentView.tt-late-flag' | translate }}"
                              tooltipPosition="bottom"
                              [rounded]="true"
                              [text]="true"
                              severity="danger" />
                  }
                } @else {
                  {{ rowData[column.field] }}
                }
              </td>
            }
          </tr>
        </ng-template>
      </p-table>
    </p-accordionTab>
  }
</p-accordion>
